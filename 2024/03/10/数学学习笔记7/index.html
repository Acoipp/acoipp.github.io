
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>数学学习笔记7 - Acoipp 的个人博客</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="OI/ACM 相关笔记,多项式备注：多项式基本操作此处不再说明，都比较简略，此处只介绍重要结论以及算法。
多项式 ln&amp;#x2F;exp暴力解法首先引入概念设 $A(x)&amp;#x3D;\ln(B(x)),B(x)&amp;#x3D;,"> 
    <meta name="author" content="Acoipp"> 
    <link rel="alternative" href="atom.xml" title="Acoipp 的个人博客" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="数学学习笔记7 - Acoipp 的个人博客"/>
    <meta name="twitter:description" content="OI/ACM 相关笔记,多项式备注：多项式基本操作此处不再说明，都比较简略，此处只介绍重要结论以及算法。
多项式 ln&amp;#x2F;exp暴力解法首先引入概念设 $A(x)&amp;#x3D;\ln(B(x)),B(x)&amp;#x3D;,"/>
    
    
    
    
    <meta property="og:site_name" content="Acoipp 的个人博客"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="数学学习笔记7 - Acoipp 的个人博客"/>
    <meta property="og:description" content="OI/ACM 相关笔记,多项式备注：多项式基本操作此处不再说明，都比较简略，此处只介绍重要结论以及算法。
多项式 ln&amp;#x2F;exp暴力解法首先引入概念设 $A(x)&amp;#x3D;\ln(B(x)),B(x)&amp;#x3D;,"/>
    
<link rel="stylesheet" href="/css/diaspora.css">

    <script>window.searchDbPath = "/search.xml";</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap" rel="stylesheet">
<meta name="generator" content="Hexo 7.0.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Acoipp 的个人博客</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://example.com"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">数学学习笔记7</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">数学学习笔记7</h1>
        <div class="stuff">
            <span>三月 10, 2024</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/FFT/" rel="tag">FFT</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/FWT/" rel="tag">FWT</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/NTT/" rel="tag">NTT</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/OI/" rel="tag">OI</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F/" rel="tag">多项式</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E6%8B%89%E6%A0%BC%E6%9C%97%E6%97%A5%E6%8F%92%E5%80%BC/" rel="tag">拉格朗日插值</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/%E6%95%B0%E5%AD%A6/" rel="tag">数学</a></li></ul>


        </div>
        <div class="content markdown">
            <h1 id="多项式"><a href="#多项式" class="headerlink" title="多项式"></a>多项式</h1><p>备注：多项式基本操作此处不再说明，都比较简略，此处只介绍重要结论以及算法。</p>
<h2 id="多项式-ln-exp"><a href="#多项式-ln-exp" class="headerlink" title="多项式 ln&#x2F;exp"></a>多项式 ln&#x2F;exp</h2><h3 id="暴力解法"><a href="#暴力解法" class="headerlink" title="暴力解法"></a>暴力解法</h3><p>首先引入概念设 $A(x)&#x3D;\ln(B(x)),B(x)&#x3D;\exp(A(x))$，那么我们可以看做 $A_x$ 是 $x$ 个点的带标号无向连通图，$B_x$ 是 $x$ 个点的带标号无向普通图，于是我们根据组合意义得到下面的公式：<br>$$<br>n!B_n &#x3D; \sum_{i&#x3D;1}^n C_{n-1}^{i-1}i!A_i(n-i)!B_{n-i}<br>$$</p>
<p>可以化简成：</p>
<p>$$<br>B_n &#x3D; \sum_{i&#x3D;1}^n A_iB_{n-i}\frac in<br>$$</p>
<p>反过来，$A$ 也可以通过 $B$ 得出来：</p>
<p>$$<br>A_n &#x3D; B_n-\sum_{i&#x3D;1}^{n-1} A_iB_{n-i}\frac in<br>$$</p>
<p>当然，还有一种对于 $\ln(1+ax)$ 的化简公式：</p>
<p>$$<br>\ln(1+ax) &#x3D; \sum_{i&#x3D;1}^{\text{inf}}\frac 1i(-1)^{i-1}a^ix^i<br>$$</p>
<p>如果我们需要求出第 $n$ 项在 exp 之后的值，直接保留前 $n$ 项就可以了。</p>
<p><strong>注意：根据 $\ln,\exp$ 的定义，可得 $A_0&#x3D;0,B_0&#x3D;1$。</strong></p>
<h2 id="复数"><a href="#复数" class="headerlink" title="复数"></a>复数</h2><p>给原有的实数集 $R$ 添加一个元素，然后任意元素表出来的所有集合称作复数集 $C$。</p>
<p>添加的元素是 $i&#x3D;\sqrt{-1}$，因此 $C$ 中的每个元素可以唯一使用 $a+bi(a \in R,b \in R)$ 表示，并且这个域中的加法乘法运算具有封闭性。</p>
<p>其中 $a$ 称作这个复数的实部，$b$ 称作这个复数的虚部。</p>
<h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h3><p>加&#x2F;减法：$(a+bi)+(c+di)&#x3D;(a+c)+(b+d)i$。</p>
<p>乘法：$(a+bi)(c+di)&#x3D;(ac-bd)+(ad+bc)i$。（乘法分配律展开即可）</p>
<p>除法：$\frac {a+bi}{c+di}&#x3D;\frac {(a+bi)(c-di)}{(c+di)(c-di)}&#x3D;\frac{ac+bd+bci-adi}{c^2+d^2}&#x3D;\frac{ac+bd}{c^2+d^2}+\frac{bc-ad}{c^2+d^2}i$。</p>
<h3 id="平面几何"><a href="#平面几何" class="headerlink" title="平面几何"></a>平面几何</h3><p>因为每个复数可以看作平面上的一个点，于是设平面的 $x$ 轴为实轴；$y$ 轴为虚轴，$a+bi$ 在平面上的坐标就是 $(a,b)$，其模长就是这个向量的长度。</p>
<p>所有模长等于 $1$ 的复数在平面直角坐标系上构成了单位圆，即一个半径为 $1$ 的圆，这些复数也称作单位复数。</p>
<p>单位复数与单位复数的乘积还是单位复数，也就是这些单位复数也构成一个具有运算封闭性的群。</p>
<p>这个平面直角坐标系有一个特殊的名字：<strong>复平面</strong>。</p>
<p>在极坐标的视角下，复数的乘除法变得很简单。<strong>复数乘法，模相乘，辐角相加。复数除法，模相除，辐角相减。</strong></p>
<h3 id="欧拉公式"><a href="#欧拉公式" class="headerlink" title="欧拉公式"></a>欧拉公式</h3><p>对于任意实数 $x$，有：</p>
<p>$$<br>e^{ix}&#x3D;\cos x+i \sin x<br>$$</p>
<p>这个公式我们此处不做证明，感兴趣的可以查一下资料了解。</p>
<h3 id="单位根"><a href="#单位根" class="headerlink" title="单位根"></a>单位根</h3><p>设 $x^n&#x3D;1$ 在复数意义下的解 $x$ 是 $n$ 次复根。根据单位复数的知识，这样的解一共有 $n$ 个，并且平分单位圆，这些解就称作单位根。</p>
<p>设 $\omega_{n}^{k} &#x3D; \exp \frac {2\pi k}{n}$，则 $x^n&#x3D;1$ 的解集就是 $\omega_{n}^{0 \sim n-1}$。（关于 $\frac {2\pi k}{n}$ 的角度表示可以参考 计算几何-极坐标）</p>
<p>并且因为 $\exp (i \theta)&#x3D;\cos \theta + i \sin \theta$，所以我们可以快速得到所有 $\omega_n$。（这个公式的详细推导需要用到三角函数等知识，此处不再赘述）</p>
<p>根据单位圆的性质，容易发现：</p>
<p>$$<br>\omega_{n}^n &#x3D;1,\omega_{2n}^{2k} &#x3D; \omega_n^k,\omega_{2n}^{n+k} &#x3D; -\omega_{2n}^k<br>$$</p>
<p>上面的三个公式会在 FFT（快速傅里叶变换）中得到应用。</p>
<p>并且如果 $k$ 等于 $1$，则所有 $\omega$ 都可以通过 $\omega_{n}^1$ 的次幂表示。（$\omega_n^1$ 是从 $1$ 开始逆时针方向遇到的第一个单位根）</p>
<h3 id="本源单位根"><a href="#本源单位根" class="headerlink" title="本源单位根"></a>本源单位根</h3><p>为什么说，上述 $n$ 个解都是 $n$ 次单位根，而平时说的 $n$ 次单位根一般特指第一个？</p>
<p>特指第一个，是为了在应用时方便。</p>
<p>在解方程的视角看来，满足 $\omega_n$ 性质的不止 $\omega_n$ 一个，对于 $\omega_n$ 的若干次幂也会满足性质。</p>
<p>称集合：${\omega_n^k\mid 0\le k&lt;n, \gcd(n,k)&#x3D;1}$<br>中的元素为<strong>本原单位根</strong>。任意一个本原单位根 $\omega$，与上述 $\omega_n$ 具有相同的性质：对于任意的 $0&lt;k&lt;n$，$\omega$ 的 $k$ 次幂不为 $1$。因此，借助任意一个本原单位根，都可以生成全体单位根。</p>
<p>全体 $n$ 次本原单位根共有 $\varphi(n)$ 个，很好证明。</p>
<h2 id="FFT（快速傅里叶变换）"><a href="#FFT（快速傅里叶变换）" class="headerlink" title="FFT（快速傅里叶变换）"></a>FFT（快速傅里叶变换）</h2><p>如果给了两个多项式 $A(x)$ 和 $B(x)$ 求出 $A \times B$ 的值，时间复杂度是 $O(n^2)$ 的。</p>
<p>如果我们给了两个多项式 $A(x),B(x)$ 在 $x &#x3D; 1 \sim n+1$ 地方的取值，求出 $A \times B$ 在 $x &#x3D; 1 \sim n+1$ 地方的取值，那么可以做到直接相乘 $O(n)$。</p>
<p>最后我们需要根据点值求出系数，又要用到拉格朗日插值，时间复杂度是 $O(n^2)$ 的。</p>
<p>这启发我们使用恰当的 $x$，算出点值之后求出系数，这就是 FFT 的精髓所在。</p>
<p>设 $A$ 的次数为 $n$，$B$ 的次数为 $m$。</p>
<p>FFT 使用了单位根来计算点值并且还原系数，我们设 $N$ 是第一个大于 $n+m$ 的二的次幂，则 FFT 选择的点就是 $\omega_{N}^{1 \sim N}$，并且在 $\log$ 时间范围内计算出点值。</p>
<p>于是我们考虑 $f(x)&#x3D;a_0+a_1x+a_2x^2+a_3x^3+a_4x^4+a_5x^5+a_6x^6+a_7x^7$，我们可以按照奇偶分组：</p>
<p>$$<br>G(x)&#x3D;a_0+a_2x+a_4x^2+a_6x^3 \\<br>H(x)&#x3D;a_1+a_3x^1+a_5x^2+a_7x^3<br>$$</p>
<p>所以 $f(x)&#x3D;G(x^2)+xH(x^2)$，因为 $\omega_{n}^k&#x3D; - \omega_{n}^{k+\frac n2}$，所以 $G({\omega_{n}^k}^2)&#x3D;G({(-\omega_{n}^{k+\frac n2}})^2)$，对于 $H(x^2)$ 同理。</p>
<p>所以我们可以直接进行计算：$f(\omega_{n}^k)&#x3D;G({\omega_{n}^k}^2)+\omega_{n}^kH({\omega_{n}^k}^2),f(\omega_{n}^{k+\frac n2})&#x3D;G({\omega_{n}^k}^2)-\omega_{n}^kH({\omega_{n}^k}^2)$。</p>
<p>于是根据 ${\omega_{n}^k}^2&#x3D;\omega_{n}^{2k}&#x3D;\omega_{\frac n2}^k$ 递归计算即可。</p>
<p>因为每次都必须是 $2$ 的倍数（$n$），所以最开始我们令 $N&#x3D;2^k$，然后就能得到一个常数很大的代码（递归版本）。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;complex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> std::complex&lt;<span class="type">double</span>&gt; Comp;  <span class="comment">// STL complex</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> Comp <span class="title">I</span><span class="params">(<span class="number">0</span>, <span class="number">1</span>)</span></span>;  <span class="comment">// i</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAX_N = <span class="number">1</span> &lt;&lt; <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">Comp tmp[MAX_N];</span><br><span class="line"></span><br><span class="line"><span class="comment">// rev=1,DFT; rev=-1,IDFT</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFT</span><span class="params">(Comp* f, <span class="type">int</span> n, <span class="type">int</span> rev)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) tmp[i] = f[i];</span><br><span class="line">  <span class="comment">// 偶数放左边，奇数放右边</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">      f[n / <span class="number">2</span> + i / <span class="number">2</span>] = tmp[i];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      f[i / <span class="number">2</span>] = tmp[i];</span><br><span class="line">  &#125;</span><br><span class="line">  Comp *g = f, *h = f + n / <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// 递归 DFT</span></span><br><span class="line">  <span class="built_in">DFT</span>(g, n / <span class="number">2</span>, rev), <span class="built_in">DFT</span>(h, n / <span class="number">2</span>, rev);</span><br><span class="line">  <span class="comment">// cur 是当前单位复根，对于 k = 0 而言，它对应的单位复根 omega^0_n = 1。</span></span><br><span class="line">  <span class="comment">// step 是两个单位复根的差，即满足 omega^k_n = step*omega^&#123;k-1&#125;*n，</span></span><br><span class="line">  <span class="comment">// 定义等价于 exp(I*(2*M_PI/n*rev))</span></span><br><span class="line">  <span class="function">Comp <span class="title">cur</span><span class="params">(<span class="number">1</span>, <span class="number">0</span>)</span>, <span class="title">step</span><span class="params">(cos(<span class="number">2</span> * M_PI / n), sin(<span class="number">2</span> * M_PI * rev / n))</span></span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n / <span class="number">2</span>;</span><br><span class="line">       ++k) &#123;  <span class="comment">// F(omega^k_n) = G(omega^k*&#123;n/2&#125;) + omega^k*n\*H(omega^k*&#123;n/2&#125;)</span></span><br><span class="line">    tmp[k] = g[k] + cur * h[k];</span><br><span class="line">    <span class="comment">// F(omega^&#123;k+n/2&#125;*n) = G(omega^k*&#123;n/2&#125;) - omega^k_n*H(omega^k\_&#123;n/2&#125;)</span></span><br><span class="line">    tmp[k + n / <span class="number">2</span>] = g[k] - cur * h[k];</span><br><span class="line">    cur *= step;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) f[i] = tmp[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="常数优化"><a href="#常数优化" class="headerlink" title="常数优化"></a>常数优化</h3><p>首先考虑最后我们每次按照奇偶分类最后的 $f$ 是什么样子，事实上就是它在 $0 \sim k-1$ 位翻转后的结果，每次递推计算这个翻转后的位置就好：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 同样需要保证 len 是 2 的幂</span></span><br><span class="line"><span class="comment">// 记 rev[i] 为 i 翻转后的值</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">change</span><span class="params">(Complex y[], <span class="type">int</span> len)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">    rev[i] = rev[i &gt;&gt; <span class="number">1</span>] &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (i &amp; <span class="number">1</span>) &#123;  <span class="comment">// 如果最后一位是 1，则翻转成 len/2</span></span><br><span class="line">      rev[i] |= len &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i &lt; rev[i]) &#123;  <span class="comment">// 保证每对数只翻转一次</span></span><br><span class="line">      <span class="built_in">swap</span>(y[i], y[rev[i]]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们每次执行运算 $f(\omega_n) \to f(\omega_{2n})$ 只需要直接在原位置上进行计算就可以了。</p>
<h3 id="点值得到系数"><a href="#点值得到系数" class="headerlink" title="点值得到系数"></a>点值得到系数</h3><p>得到了最终多项式的点值之后我们要知道各个项数的系数是多少，于是我们还得学习快速傅里叶逆变换。</p>
<p>IDFT（傅里叶反变换）的作用，是把目标多项式的点值形式转换成系数形式。而 DFT 本身是个线性变换，可以理解为将目标多项式当作向量，左乘一个矩阵得到变换后的向量，以模拟把单位复根代入多项式的过程：</p>
<h1 id="begin-bmatrix-y-0-y-1-y-2-y-3-vdots-y-n-1-end-bmatrix"><a href="#begin-bmatrix-y-0-y-1-y-2-y-3-vdots-y-n-1-end-bmatrix" class="headerlink" title="$$\begin{bmatrix}y_0 \\ y_1 \\ y_2 \\ y_3 \\ \vdots \\ y_{n-1} \end{bmatrix}"></a>$$<br>\begin{bmatrix}y_0 \\ y_1 \\ y_2 \\ y_3 \\ \vdots \\ y_{n-1} \end{bmatrix}</h1><p>\begin{bmatrix}1 &amp; 1 &amp; 1 &amp; 1 &amp; \cdots &amp; 1 \\<br>1 &amp; \omega_n^1 &amp; \omega_n^2 &amp; \omega_n^3 &amp; \cdots &amp; \omega_n^{n-1} \\<br>1 &amp; \omega_n^2 &amp; \omega_n^4 &amp; \omega_n^6 &amp; \cdots &amp; \omega_n^{2(n-1)} \\<br>1 &amp; \omega_n^3 &amp; \omega_n^6 &amp; \omega_n^9 &amp; \cdots &amp; \omega_n^{3(n-1)} \\<br>\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\<br>1 &amp; \omega_n^{n-1} &amp; \omega_n^{2(n-1)} &amp; \omega_n^{3(n-1)} &amp; \cdots &amp; \omega_n^{(n-1)^2} \end{bmatrix}<br>\begin{bmatrix} a_0 \\ a_1 \\ a_2 \\ a_3 \\ \vdots \\ a_{n-1} \end{bmatrix}<br>$$<br>现在我们已经得到最左边的结果了，中间的 $x$ 值在目标多项式的点值表示中也是一一对应的，所以，根据矩阵的基础知识，我们只要在式子两边左乘中间那个大矩阵的逆矩阵就行了。</p>
<p>由于这个矩阵的元素非常特殊，它的逆矩阵也有特殊的性质，就是每一项取倒数，再除以变换的长度 $n$，就能得到它的逆矩阵。</p>
<p>为了使计算的结果为原来的倒数，根据欧拉公式，可以得到</p>
<p>$$\frac{1}{\omega_k}&#x3D;\omega_k^{-1}&#x3D;e^{-\frac{2\pi i}{k}}&#x3D;\cos\left(\frac{2\pi}{k}\right)+i \sin\left(-\frac{2\pi}{k}\right)$$<br>因此我们可以尝试着把单位根 $\omega_k$ 取成 $e^{-\frac{2\pi \mathrm{i}}{k}}$，这样我们的计算结果就会变成原来的倒数，之后唯一多的操作就只有再除以它的长度 $n$，而其它的操作过程与 DFT 是完全相同的。我们可以定义一个函数，在里面加一个参数 $1$ 或者是 $-1$，然后把它乘到 $\pi$ 上。传入 $1$ 就是 DFT，传入 $-1$ 就是 IDFT。</p>
<p>最后我们以 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3803">P3803 【模板】多项式乘法（FFT）</a> 为例子看一下代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 4000005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">nc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> buf[<span class="number">1000000</span>],*p=buf,*q=buf;</span><br><span class="line">	<span class="keyword">return</span> p==q&amp;&amp;(q=(p=buf)+<span class="built_in">fread</span>(buf,<span class="number">1</span>,<span class="number">1000000</span>,stdin),p==q)?EOF:*p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> res = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> c = <span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>)c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;c&gt;=<span class="string">&#x27;0&#x27;</span>)res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> obuf[<span class="number">1</span>&lt;&lt;<span class="number">21</span>],*p3=obuf; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> c)</span></span>&#123; </span><br><span class="line">	p3-obuf&lt;=(<span class="number">1</span>&lt;&lt;<span class="number">20</span>)?(*p3++=c):(<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout),p3=obuf,*p3++=c); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">int</span> x)</span></span>&#123; </span><br><span class="line">	<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>),x=-x; </span><br><span class="line">	<span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>); </span><br><span class="line">	<span class="built_in">pc</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eps = <span class="number">1e-8</span>,pi = <span class="built_in">acos</span>(<span class="number">-1.0</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">poly</span>&#123;db re,im;&#125;a[N],b[N],c[N];</span><br><span class="line"><span class="keyword">inline</span> poly <span class="keyword">operator</span>+(poly &amp;a,poly &amp;b)&#123;<span class="keyword">return</span> (poly)&#123;a.re+b.re,a.im+b.im&#125;;&#125;</span><br><span class="line"><span class="keyword">inline</span> poly <span class="keyword">operator</span>-(poly &amp;a,poly &amp;b)&#123;<span class="keyword">return</span> (poly)&#123;a.re-b.re,a.im-b.im&#125;;&#125;</span><br><span class="line"><span class="keyword">inline</span> poly <span class="keyword">operator</span>*(poly &amp;a,poly &amp;b)&#123;<span class="keyword">return</span> (poly)&#123;a.re*b.re-a.im*b.im,a.re*b.im+a.im*b.re&#125;;&#125;</span><br><span class="line"><span class="type">int</span> n,m,i,res[N],las;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">fft</span><span class="params">(poly *f,<span class="type">int</span> n,<span class="type">int</span> type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i&lt;res[i]) <span class="built_in">swap</span>(f[i],f[res[i]]);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;n;i*=<span class="number">2</span>)&#123;</span><br><span class="line">		poly wn = (poly)&#123;<span class="built_in">cos</span>(pi/i),<span class="built_in">sin</span>(pi/i)*type&#125;;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> r=i*<span class="number">2</span>,j=<span class="number">0</span>;j&lt;n;j+=r)&#123;</span><br><span class="line">			poly w = (poly)&#123;<span class="number">1</span>,<span class="number">0</span>&#125;;</span><br><span class="line">			<span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;i;k++,w=w*wn)&#123;</span><br><span class="line">				poly x = f[j+k],y = w*f[j+k+i];</span><br><span class="line">				f[j+k] = x+y,f[j+k+i] = x-y;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">//	freopen(&quot;22.in&quot;,&quot;r&quot;,stdin);</span></span><br><span class="line">	n=<span class="built_in">read</span>()+<span class="number">1</span>,m=<span class="built_in">read</span>()+<span class="number">1</span>;</span><br><span class="line">	las=n+m<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) a[i].re=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;m;i++) b[i].re=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">while</span>((n&amp;(-n))!=n) n++;</span><br><span class="line">	<span class="keyword">while</span>((m&amp;(-m))!=m) m++;</span><br><span class="line">	<span class="keyword">while</span>(n&lt;m) n++;</span><br><span class="line">	<span class="keyword">while</span>(m&lt;n) m++;</span><br><span class="line">	n*=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		res[i]=(res[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(i&amp;<span class="number">1</span>) res[i]|=(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">fft</span>(a,n,<span class="number">1</span>),<span class="built_in">fft</span>(b,n,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) c[i]=a[i]*b[i];</span><br><span class="line">	<span class="built_in">fft</span>(c,n,<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;las;i++) <span class="built_in">write</span>(<span class="built_in">round</span>(c[i].re/n)),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	<span class="built_in">pc</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">	<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后记得因为精度有误差，必须要四舍五入一下，并且 $\frac 1n$ 需要写在四舍五入函数的里面。</p>
<h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>FFT 用于快速求解：</p>
<p>$$<br>C_i &#x3D; \sum_{j&#x3D;0}^i A_jB_{i-j}<br>$$</p>
<p>的所有 $C$ 的值，与此相同，如果 $A,B$ 的系数是凸的，那么闵可夫斯基和求的就是：</p>
<p>$$<br>C_i &#x3D; \max_{j&#x3D;0}^i A_j+B_{i-j}<br>$$</p>
<p>同时我们还可以想到迪利克雷卷积（上面那个一般称作循环卷积）：</p>
<p>$$<br>C_i &#x3D; \sum_{j \mid i} A_jB_{\frac ij}<br>$$</p>
<p>上面这几个可以在 $O(n \log n),O(n),O(n \log n)$ 范围内解决，都很优秀，做题的时候偏重在于转化模型得到上面的答案，再应用工具输出最终结果。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>FFT 同时可以利用一些循环的性质来解决（证明用到了单位根的循环性质，自证不难）</p>
<p>如果我们前两遍 FFT 的时候长度为 $N(N&gt;n,N&gt;m)$ 但是 $N&lt;n+m-1$，即第三遍合并的时候项数不够，那么最后的结果就是一个循环移位的结果，设标准结果为 $C$，此方法得到的结果为 $C’$，则有：</p>
<p>$$<br>C’<em>i &#x3D; \sum</em>{k \ge 0} C_{i+kN}<br>$$</p>
<p>于是我们可以通过这个方法来去掉不需要的项来减少常数消耗。</p>
<h2 id="NTT-（快速数论变换）"><a href="#NTT-（快速数论变换）" class="headerlink" title="NTT （快速数论变换）"></a>NTT （快速数论变换）</h2><p>相比于 FFT，每个数值都需要对 $mod$ 取模，这个的处理方式也很简单。</p>
<p>$mod$ 如果是质数就可以找到一个原根，满足原根的 $\varphi$ 次方对 $mod$ 取模后是 $1$ 和一些其它的性质。</p>
<p>因此我们就可以仿照单位根那样进行计算，原根基本上具有单位根的所有性质，所以这样做是对的。</p>
<p>接下来我们需要考虑一下哪些模数可以作为 NTT 模数，因为原根的循环节是 $\varphi$ 长度的，所以 $N$ 一定要整数 $\varphi$ 即 $mod-1$，并且 $N&#x3D;2^k$，所以一个模数可以作为 NTT 模数当且仅当它分解为 $2^t \times p+q$ 之后 $2^t$ 大于等于 $N$。</p>
<p>常见的 NTT 模数就是 $998244353$，下面提供了一份 NTT 模板，把复数类换成整数类，把单位根换成原根就可以了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		res[i]=((res[i&gt;&gt;<span class="number">1</span>])&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(i&amp;<span class="number">1</span>) res[i]+=(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">clear</span><span class="params">(ll n)</span></span>&#123;<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) a[i]=b[i]=c[i]=<span class="number">0</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(ll *f,ll n,ll type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i&lt;res[i]) <span class="built_in">swap</span>(f[i],f[res[i]]);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;n;i*=<span class="number">2</span>)&#123;</span><br><span class="line">		ll wn = <span class="built_in">qmi</span>((type==<span class="number">1</span>?G:invG),(mod<span class="number">-1</span>)/(i*<span class="number">2</span>),mod);</span><br><span class="line">		<span class="keyword">for</span>(ll j=<span class="number">1</span>;j&lt;i;j++) qm[j]=qm[j<span class="number">-1</span>]*wn%mod;</span><br><span class="line">		<span class="keyword">for</span>(ll r=i*<span class="number">2</span>,j=<span class="number">0</span>;j&lt;n;j+=r)&#123;</span><br><span class="line">			<span class="keyword">for</span>(ll k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">				ll x = f[j+k],y = qm[k]*f[j+k+i]%mod;</span><br><span class="line">				f[j+k] = (x+y)%mod,f[j+k+i] = (x-y+mod)%mod;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>补充：据说还有任意模数多项式乘法，但是并不常见，下面列举一种常见的解法：</p>
<ul>
<li>找 $3$ 个质数，满足其 $\operatorname{lcm}$ 大于等于最大的数，然后用 CRT 合并起来对要求的数取模就可以了。</li>
</ul>
<p>这样的写法需要用 <code>long double</code> 合并并且常数是 $9$ 倍 NTT，如果代码写得比较好看的话，对于 $n \le 10^5$ 完全足够了。</p>
<h2 id="多项式相关操作"><a href="#多项式相关操作" class="headerlink" title="多项式相关操作"></a>多项式相关操作</h2><h3 id="多项式乘法"><a href="#多项式乘法" class="headerlink" title="多项式乘法"></a>多项式乘法</h3><p>取模：NTT&#x2F;CRT+NTT。</p>
<p>不取模：FFT&#x2F;CRT+NTT。</p>
<h3 id="多项式逆元"><a href="#多项式逆元" class="headerlink" title="多项式逆元"></a>多项式逆元</h3><p>设 $A(x) \cdot B(x) \equiv 1 \pmod {x^n}$（后面的 $\bmod \ x^n$ 表示保留 $0 \sim n-1$ 次项的系数）</p>
<p>我们考虑化一下公式：</p>
<p>$$<br>\begin{aligned}<br>A(x) \cdot B(x) \equiv 1 \pmod {x^n}<br>\end{aligned}<br>$$</p>
<p>设 $A(x) \cdot B’(x) \equiv 1 \pmod {x^{\lceil \frac n2 \rceil}}$，则有：</p>
<p>$$<br>\begin{aligned}<br>A(x) \cdot (B(x)-B’(x)) &amp;\equiv 0 \pmod {x^{\lceil \frac n2 \rceil}} \\<br>(B(x)-B’(x)) &amp;\equiv 0 \pmod {x^{\lceil \frac n2 \rceil}} \\</p>
<p>(B(x)-B’(x))^2 &amp;\equiv 0 \pmod {x^n} \\</p>
<p>B(x)^2+B’(x)^2-2B(x)B’(x) &amp;\equiv 0 \pmod {x^n} \\</p>
<p>B(x)+A(x)B’(x)^2-2B’(x) &amp;\equiv 0 \pmod {x^n} \\</p>
<p>B(x) &amp;\equiv 2B’(x)-A(x)B’(x)^2 \pmod {x^n} \\<br>\end{aligned}<br>$$</p>
<p>于是我们就得到了 $B(x)$ 的递归式，每一层递归式使用 NTT 求解即可，时间复杂度为 $T(n)&#x3D;T(\frac n2)+O(n \log n)$，所以 $T(n)&#x3D;O(n \log n)$。</p>
<p>边界条件就是常数项 $B(0)&#x3D;A(0)^{-1}$。</p>
<p>以 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4238">P4238 【模板】多项式乘法逆</a> 参考一下代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 500005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll n,G,invG,i,res[N],qm[N],val[N],val2[N],temp[N],tempa[N],tempb[N],sqval[N],valq[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qmi</span><span class="params">(ll a,ll b,ll p)</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">1</span>,t = a;</span><br><span class="line">	<span class="keyword">while</span>(b)&#123;</span><br><span class="line">		<span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*t%p;</span><br><span class="line">		t=t*t%p;</span><br><span class="line">		b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		res[i]=((res[i&gt;&gt;<span class="number">1</span>])&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(i&amp;<span class="number">1</span>) res[i]+=(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(ll *f,ll n,ll type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i&lt;res[i]) <span class="built_in">swap</span>(f[i],f[res[i]]);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;n;i*=<span class="number">2</span>)&#123;</span><br><span class="line">		ll wn = <span class="built_in">qmi</span>((type==<span class="number">1</span>?G:invG),(mod<span class="number">-1</span>)/(i*<span class="number">2</span>),mod);</span><br><span class="line">		<span class="keyword">for</span>(ll j=<span class="number">1</span>;j&lt;i;j++) qm[j]=qm[j<span class="number">-1</span>]*wn%mod;</span><br><span class="line">		<span class="keyword">for</span>(ll r=i*<span class="number">2</span>,j=<span class="number">0</span>;j&lt;n;j+=r)&#123;</span><br><span class="line">			<span class="keyword">for</span>(ll k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">				ll x = f[j+k],y = qm[k]*f[j+k+i]%mod;</span><br><span class="line">				f[j+k] = (x+y)%mod,f[j+k+i] = (x-y+mod)%mod;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">nc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> buf[<span class="number">1000000</span>],*p=buf,*q=buf;</span><br><span class="line">	<span class="keyword">return</span> p==q&amp;&amp;(q=(p=buf)+<span class="built_in">fread</span>(buf,<span class="number">1</span>,<span class="number">1000000</span>,stdin),p==q)?EOF:*p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> c = <span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>)c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;c&gt;=<span class="string">&#x27;0&#x27;</span>)res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> obuf[<span class="number">1</span>&lt;&lt;<span class="number">21</span>],*p3=obuf; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> c)</span></span>&#123; </span><br><span class="line">	p3-obuf&lt;=(<span class="number">1</span>&lt;&lt;<span class="number">20</span>)?(*p3++=c):(<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout),p3=obuf,*p3++=c); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(ll x)</span></span>&#123; </span><br><span class="line">	<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>),x=-x; </span><br><span class="line">	<span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>); </span><br><span class="line">	<span class="built_in">pc</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">times</span><span class="params">(ll *a,ll *b,ll *c,ll n,ll tim)</span></span>&#123;</span><br><span class="line">	ll nn = n;</span><br><span class="line">	<span class="keyword">while</span>((n&amp;(-n))!=n) n++;</span><br><span class="line">	n*=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) tempa[i]=(i&gt;=nn?<span class="number">0</span>:a[i]),tempb[i]=(i&gt;=nn?<span class="number">0</span>:b[i]);</span><br><span class="line">	<span class="built_in">init</span>(n),<span class="built_in">ntt</span>(tempa,n,<span class="number">1</span>),<span class="built_in">ntt</span>(tempb,n,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(tim==<span class="number">1</span>) c[i]=tempa[i]*tempb[i]%mod;</span><br><span class="line">		<span class="keyword">else</span> c[i]=tempa[i]*tempb[i]%mod*tempb[i]%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">ntt</span>(c,n,<span class="number">-1</span>);</span><br><span class="line">	ll invn = <span class="built_in">qmi</span>(n,mod<span class="number">-2</span>,mod);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) c[i]=c[i]*invn%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		val2[<span class="number">0</span>] = <span class="built_in">qmi</span>(val[<span class="number">0</span>],mod<span class="number">-2</span>,mod);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	ll len = (x+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">solve</span>(len);</span><br><span class="line">	<span class="built_in">times</span>(val,val2,temp,x,<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val2[i]=((<span class="number">2</span>*val2[i]-temp[i])%mod+mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	G=<span class="number">3</span>,invG=<span class="built_in">qmi</span>(G,mod<span class="number">-2</span>,mod),qm[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	n=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) val[i]=<span class="built_in">read</span>();</span><br><span class="line">	<span class="built_in">solve</span>(n);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">write</span>(val2[i]),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多项式除法"><a href="#多项式除法" class="headerlink" title="多项式除法"></a>多项式除法</h3><p>我们要求出 $F(x)$ 除以 $G(x)$ 的商 $R(x)$ 和余数 $Q(x)$。</p>
<p>其中 $F(x)$ 的次数是 $n$，$G(x)$ 的次数是 $m$，$R(x)$ 的次数是 $n-m$，$Q(x)$ 的次数不超过 $m-1$，这里可以看作 $m-1$（高次项补零）。</p>
<p>设 $F_R(x)$ 表示将 $F(x)$ 的系数翻转（次数）后形成的函数。</p>
<p>那么就有下面的公式：</p>
<p>$$<br>\begin{aligned}<br>F(x)&amp;&#x3D;G(x)R(x)+Q(x) \\<br>F(\frac 1x) &amp;&#x3D; G(\frac 1x)R(\frac 1x)+Q(\frac 1x) \\<br>F(\frac 1x)x^n &amp;&#x3D; G(\frac 1x)x^mR(\frac 1x)x^{n-m}+Q(\frac 1x)x^{m-1}x^{n-m+1} \\<br>F(\frac 1x)x^n &amp;&#x3D; G(\frac 1x)x^mR(\frac 1x)x^{n-m}+Q(\frac 1x)x^{m-1}x^{n-m+1} \\<br>F_R(x) &amp;&#x3D; G_R(x)R_R(x)+Q_R(x)x^{n-m+1} \\<br>F_R(x) &amp;\equiv G_R(x)R_R(x) \pmod {x^{n-m+1}}</p>
<p>\end{aligned}<br>$$</p>
<p>于是对 $G_R(x)$ 求逆之后 NTT 就可以求出 $R_R(x)$ 和 $R(x)$，顺便还可以求出 $Q(x)&#x3D;F(x)-G(x)R(x)$。</p>
<p>因为 $R$ 的次数是 $n-m$ 所以我们这么求出来的 $R$ 是对的，又因为 $Q(x)x^{n-m+1}$ 不超过 $n$ 次项，所以 $Q(x)$ 最后的结果也是不超过 $m-1$ 次项的。</p>
<p>以 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4512">P4512 【模板】多项式除法</a> 为例，参考如下代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 2000005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll n,m,nn,G,invG,invn,i,res[N],qm[N],aval[N],bval[N],cval[N],val[N],val2[N],temp[N],tempp[N],len;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qmi</span><span class="params">(ll a,ll b,ll p)</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">1</span>,t = a;</span><br><span class="line">	<span class="keyword">while</span>(b)&#123;</span><br><span class="line">		<span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*t%p;</span><br><span class="line">		t=t*t%p;</span><br><span class="line">		b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		res[i]=((res[i&gt;&gt;<span class="number">1</span>])&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(i&amp;<span class="number">1</span>) res[i]+=(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(ll *f,ll n,ll type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i&lt;res[i]) <span class="built_in">swap</span>(f[i],f[res[i]]);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;n;i*=<span class="number">2</span>)&#123;</span><br><span class="line">		ll wn = <span class="built_in">qmi</span>((type==<span class="number">1</span>?G:invG),(mod<span class="number">-1</span>)/(i*<span class="number">2</span>),mod);</span><br><span class="line">		<span class="keyword">for</span>(ll j=<span class="number">1</span>;j&lt;i;j++) qm[j]=qm[j<span class="number">-1</span>]*wn%mod;</span><br><span class="line">		<span class="keyword">for</span>(ll r=i*<span class="number">2</span>,j=<span class="number">0</span>;j&lt;n;j+=r)&#123;</span><br><span class="line">			<span class="keyword">for</span>(ll k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">				ll x = f[j+k],y = qm[k]*f[j+k+i]%mod;</span><br><span class="line">				f[j+k] = (x+y)%mod,f[j+k+i] = (x-y+mod)%mod;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">nc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> buf[<span class="number">1000000</span>],*p=buf,*q=buf;</span><br><span class="line">	<span class="keyword">return</span> p==q&amp;&amp;(q=(p=buf)+<span class="built_in">fread</span>(buf,<span class="number">1</span>,<span class="number">1000000</span>,stdin),p==q)?EOF:*p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">0</span>,w = <span class="number">1</span>;</span><br><span class="line">	<span class="type">char</span> c = <span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>)w=(c==<span class="string">&#x27;-&#x27;</span>?<span class="number">-1</span>:w),c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;c&gt;=<span class="string">&#x27;0&#x27;</span>)res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">return</span> res*w;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> obuf[<span class="number">1</span>&lt;&lt;<span class="number">21</span>],*p3=obuf; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> c)</span></span>&#123; </span><br><span class="line">	p3-obuf&lt;=(<span class="number">1</span>&lt;&lt;<span class="number">20</span>)?(*p3++=c):(<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout),p3=obuf,*p3++=c); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(ll x)</span></span>&#123; </span><br><span class="line">	<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>),x=-x; </span><br><span class="line">	<span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>); </span><br><span class="line">	<span class="built_in">pc</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		val2[<span class="number">0</span>] = <span class="built_in">qmi</span>(val[<span class="number">0</span>],mod<span class="number">-2</span>,mod);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">solve</span>((x+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) temp[i]=val[i],tempp[i]=val2[i];</span><br><span class="line">	ll len = x;</span><br><span class="line">	<span class="keyword">while</span>((len&amp;(-len))!=len) temp[len]=tempp[len]=<span class="number">0</span>,len++;</span><br><span class="line">	temp[len]=tempp[len]=<span class="number">0</span>,len++;</span><br><span class="line">	<span class="keyword">while</span>((len&amp;(-len))!=len) temp[len]=tempp[len]=<span class="number">0</span>,len++;</span><br><span class="line">	ll invn = <span class="built_in">qmi</span>(len,mod<span class="number">-2</span>,mod);</span><br><span class="line">	<span class="built_in">init</span>(len);</span><br><span class="line">	<span class="built_in">ntt</span>(temp,len,<span class="number">1</span>),<span class="built_in">ntt</span>(tempp,len,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;len;i++) temp[i]=temp[i]*tempp[i]%mod*tempp[i]%mod;</span><br><span class="line">	<span class="built_in">ntt</span>(temp,len,<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;len;i++) temp[i]=temp[i]*invn%mod;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val2[i]=((<span class="number">2</span>*val2[i]-temp[i])%mod+mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	G=<span class="number">3</span>,invG=<span class="built_in">qmi</span>(G,mod<span class="number">-2</span>,mod),qm[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">	n++,m++;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) aval[i]=<span class="built_in">read</span>(),cval[i]=aval[i];</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;m;i++) val[i]=<span class="built_in">read</span>(),bval[i]=val[i];</span><br><span class="line">	<span class="built_in">reverse</span>(aval,aval+n),<span class="built_in">reverse</span>(val,val+m);</span><br><span class="line">	<span class="built_in">solve</span>(n);</span><br><span class="line">	nn=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span>(nn&lt;n*<span class="number">2</span>) nn*=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(i=n;i&lt;nn;i++) aval[i]=<span class="number">0</span>,val2[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">init</span>(nn),<span class="built_in">ntt</span>(aval,nn,<span class="number">1</span>),<span class="built_in">ntt</span>(val2,nn,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;nn;i++) aval[i]=aval[i]*val2[i]%mod;</span><br><span class="line">	<span class="built_in">ntt</span>(aval,nn,<span class="number">-1</span>),invn=<span class="built_in">qmi</span>(nn,mod<span class="number">-2</span>,mod);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;nn;i++) aval[i]=aval[i]*invn%mod;</span><br><span class="line">	<span class="keyword">for</span>(i=n-m;i&gt;=<span class="number">0</span>;i--) <span class="built_in">write</span>(aval[i]),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>),val2[len++]=aval[i];</span><br><span class="line">	<span class="built_in">pc</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">	<span class="keyword">for</span>(i=len;i&lt;nn;i++) val2[i]=<span class="number">0</span>; </span><br><span class="line">	<span class="built_in">ntt</span>(bval,nn,<span class="number">1</span>),<span class="built_in">ntt</span>(val2,nn,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;nn;i++) bval[i]=bval[i]*val2[i]%mod;</span><br><span class="line">	<span class="built_in">ntt</span>(bval,nn,<span class="number">-1</span>),invn=<span class="built_in">qmi</span>(nn,mod<span class="number">-2</span>,mod);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;nn;i++) bval[i]=bval[i]*invn%mod;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;m<span class="number">-1</span>;i++) <span class="built_in">write</span>((cval[i]-bval[i]+mod)%mod),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	<span class="built_in">pc</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">	<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多项式开方"><a href="#多项式开方" class="headerlink" title="多项式开方"></a>多项式开方</h3><p>考虑像求逆元那样倍增，那么设 $H(x)^2 \equiv F(x) \pmod {x^{\lceil \frac n2 \rceil}}$，有：</p>
<p>$$<br>\begin{aligned}<br>G(x) &amp;\equiv H(x) \pmod {x^{\lceil \frac n2 \rceil}} \\<br>G(x)-H(x) &amp;\equiv 0 \pmod {x^{\lceil \frac n2 \rceil}} \\<br>(G(x)-H(x))^2 &amp;\equiv  0\pmod {x^n} \\<br>G(x)^2+H(x)^2-2G(x)H(x) &amp;\equiv  0\pmod {x^n} \\<br>H(x)^2+H(x)^2-2G(x)H(x) &amp;\equiv  0\pmod {x^n} \\<br>F(x)^2+H(x)^2-2G(x)H(x) &amp;\equiv  0\pmod {x^n} \\<br>G(x) &amp;\equiv \frac {F(x)+H(x)^2}{2H(x)}  \pmod {x^n}<br>\end{aligned}<br>$$</p>
<p>边界情况需要注意 $G(0)$ 是 $F(0)$ 的二次剩余！</p>
<p>因此我们直接 $O(n \log n)$ 求即可，下面以 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5205">P5205 【模板】多项式开根</a> 欣赏一下代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 500005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll n,G,invG,inv2,i,res[N],qm[N],val[N],val2[N],temp[N],temp2[N],tempa[N],tempb[N],sqval[N],valq[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qmi</span><span class="params">(ll a,ll b,ll p)</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">1</span>,t = a;</span><br><span class="line">	<span class="keyword">while</span>(b)&#123;</span><br><span class="line">		<span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*t%p;</span><br><span class="line">		t=t*t%p;</span><br><span class="line">		b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		res[i]=((res[i&gt;&gt;<span class="number">1</span>])&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(i&amp;<span class="number">1</span>) res[i]+=(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(ll *f,ll n,ll type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i&lt;res[i]) <span class="built_in">swap</span>(f[i],f[res[i]]);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;n;i*=<span class="number">2</span>)&#123;</span><br><span class="line">		ll wn = <span class="built_in">qmi</span>((type==<span class="number">1</span>?G:invG),(mod<span class="number">-1</span>)/(i*<span class="number">2</span>),mod);</span><br><span class="line">		<span class="keyword">for</span>(ll j=<span class="number">1</span>;j&lt;i;j++) qm[j]=qm[j<span class="number">-1</span>]*wn%mod;</span><br><span class="line">		<span class="keyword">for</span>(ll r=i*<span class="number">2</span>,j=<span class="number">0</span>;j&lt;n;j+=r)&#123;</span><br><span class="line">			<span class="keyword">for</span>(ll k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">				ll x = f[j+k],y = qm[k]*f[j+k+i]%mod;</span><br><span class="line">				f[j+k] = (x+y)%mod,f[j+k+i] = (x-y+mod)%mod;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">nc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> buf[<span class="number">1000000</span>],*p=buf,*q=buf;</span><br><span class="line">	<span class="keyword">return</span> p==q&amp;&amp;(q=(p=buf)+<span class="built_in">fread</span>(buf,<span class="number">1</span>,<span class="number">1000000</span>,stdin),p==q)?EOF:*p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> c = <span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>)c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;c&gt;=<span class="string">&#x27;0&#x27;</span>)res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> obuf[<span class="number">1</span>&lt;&lt;<span class="number">21</span>],*p3=obuf; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> c)</span></span>&#123; </span><br><span class="line">	p3-obuf&lt;=(<span class="number">1</span>&lt;&lt;<span class="number">20</span>)?(*p3++=c):(<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout),p3=obuf,*p3++=c); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(ll x)</span></span>&#123; </span><br><span class="line">	<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>),x=-x; </span><br><span class="line">	<span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>); </span><br><span class="line">	<span class="built_in">pc</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">times</span><span class="params">(ll *a,ll *b,ll *c,ll n,ll tim)</span></span>&#123;</span><br><span class="line">	ll nn = n;</span><br><span class="line">	<span class="keyword">while</span>((n&amp;(-n))!=n) n++;</span><br><span class="line">	n*=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) tempa[i]=(i&gt;=nn?<span class="number">0</span>:a[i]),tempb[i]=(i&gt;=nn?<span class="number">0</span>:b[i]);</span><br><span class="line">	<span class="built_in">init</span>(n),<span class="built_in">ntt</span>(tempa,n,<span class="number">1</span>),<span class="built_in">ntt</span>(tempb,n,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(tim==<span class="number">1</span>) c[i]=tempa[i]*tempb[i]%mod;</span><br><span class="line">		<span class="keyword">else</span> c[i]=tempa[i]*tempb[i]%mod*tempb[i]%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">ntt</span>(c,n,<span class="number">-1</span>);</span><br><span class="line">	ll invn = <span class="built_in">qmi</span>(n,mod<span class="number">-2</span>,mod);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) c[i]=c[i]*invn%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		val2[<span class="number">0</span>] = <span class="built_in">qmi</span>(val[<span class="number">0</span>],mod<span class="number">-2</span>,mod);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	ll len = (x+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">solve</span>(len);</span><br><span class="line">	<span class="built_in">times</span>(val,val2,temp2,x,<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val2[i]=((<span class="number">2</span>*val2[i]-temp2[i])%mod+mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sqr</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		sqval[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sqr</span>((x+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">	<span class="built_in">times</span>(sqval,sqval,temp,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) temp[i]=(temp[i]+valq[i])%mod;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val[i]=sqval[i],val2[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">solve</span>(x);</span><br><span class="line">	<span class="built_in">times</span>(temp,val2,temp,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) sqval[i]=temp[i]*inv2%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	G=<span class="number">3</span>,invG=<span class="built_in">qmi</span>(G,mod<span class="number">-2</span>,mod),qm[<span class="number">0</span>]=<span class="number">1</span>,inv2=<span class="built_in">qmi</span>(<span class="number">2</span>,mod<span class="number">-2</span>,mod);</span><br><span class="line">	n=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) valq[i]=<span class="built_in">read</span>();</span><br><span class="line">	<span class="built_in">sqr</span>(n);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">write</span>(sqval[i]),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>推荐多项式求逆写一个比较好看的函数，这样的话方便调试。</p>
<h3 id="多项式对数函数-ln"><a href="#多项式对数函数-ln" class="headerlink" title="多项式对数函数 ln"></a>多项式对数函数 ln</h3><p>首先设 $f’(x) &#x3D; \lim_{x \to 0} \frac {\Delta f(x)}{\Delta x}$，说人话就是斜率。</p>
<p>那么多项式 ln 需要用到的公式就是：$(\ln x)’&#x3D; \frac 1x$，$(x^a)’&#x3D;ax^{a-1}$，$(f(g(x)))’&#x3D;f’(g(x))g’(x)$。</p>
<p>那么就有 $G(x)&#x3D;F(A(x)),F(x)&#x3D;\ln(x)$，两边求导得 $G’(x)&#x3D;F’(A(x))A’(x)&#x3D;\frac {A’(x)}{A(x)}$，于是直接求导乘上逆元就可以了。</p>
<p>最后我们要通过 $G’(x)$ 还原出 $G(x)$，于是进行求导的逆运算——积分就可以了。</p>
<p>这里的积分就是 $\int x^adx&#x3D;\frac{1}{a+1}x^{a+1}$ 这一个公式。</p>
<p>代码以 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4725">P4725 【模板】多项式对数函数（多项式 ln）</a> 为例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 500005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll n,m,x,G,invG,inv2,i,res[N],qm[N],val[N],val2[N],temp[N],temp2[N],tempas[N],tempa[N],tempb[N],sqval[N],valqs[N],valq[N],ans[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qmi</span><span class="params">(ll a,ll b,ll p)</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">1</span>,t = a;</span><br><span class="line">	<span class="keyword">while</span>(b)&#123;</span><br><span class="line">		<span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*t%p;</span><br><span class="line">		t=t*t%p;</span><br><span class="line">		b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		res[i]=((res[i&gt;&gt;<span class="number">1</span>])&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(i&amp;<span class="number">1</span>) res[i]+=(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(ll *f,ll n,ll type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i&lt;res[i]) <span class="built_in">swap</span>(f[i],f[res[i]]);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;n;i*=<span class="number">2</span>)&#123;</span><br><span class="line">		ll wn = <span class="built_in">qmi</span>((type==<span class="number">1</span>?G:invG),(mod<span class="number">-1</span>)/(i*<span class="number">2</span>),mod);</span><br><span class="line">		<span class="keyword">for</span>(ll j=<span class="number">1</span>;j&lt;i;j++) qm[j]=qm[j<span class="number">-1</span>]*wn%mod;</span><br><span class="line">		<span class="keyword">for</span>(ll r=i*<span class="number">2</span>,j=<span class="number">0</span>;j&lt;n;j+=r)&#123;</span><br><span class="line">			<span class="keyword">for</span>(ll k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">				ll x = f[j+k],y = qm[k]*f[j+k+i]%mod;</span><br><span class="line">				f[j+k] = (x+y)%mod,f[j+k+i] = (x-y+mod)%mod;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">nc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> buf[<span class="number">1000000</span>],*p=buf,*q=buf;</span><br><span class="line">	<span class="keyword">return</span> p==q&amp;&amp;(q=(p=buf)+<span class="built_in">fread</span>(buf,<span class="number">1</span>,<span class="number">1000000</span>,stdin),p==q)?EOF:*p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> c = <span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>)c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;c&gt;=<span class="string">&#x27;0&#x27;</span>)res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> obuf[<span class="number">1</span>&lt;&lt;<span class="number">21</span>],*p3=obuf; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> c)</span></span>&#123; </span><br><span class="line">	p3-obuf&lt;=(<span class="number">1</span>&lt;&lt;<span class="number">20</span>)?(*p3++=c):(<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout),p3=obuf,*p3++=c); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(ll x)</span></span>&#123; </span><br><span class="line">	<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>),x=-x; </span><br><span class="line">	<span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>); </span><br><span class="line">	<span class="built_in">pc</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">times</span><span class="params">(ll *a,ll *b,ll *c,ll n,ll tim)</span></span>&#123;</span><br><span class="line">	ll nn = n;</span><br><span class="line">	<span class="keyword">while</span>((n&amp;(-n))!=n) n++;</span><br><span class="line">	n*=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) tempa[i]=(i&gt;=nn?<span class="number">0</span>:a[i]),tempb[i]=(i&gt;=nn?<span class="number">0</span>:b[i]);</span><br><span class="line">	<span class="built_in">init</span>(n),<span class="built_in">ntt</span>(tempa,n,<span class="number">1</span>),<span class="built_in">ntt</span>(tempb,n,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(tim==<span class="number">1</span>) c[i]=tempa[i]*tempb[i]%mod;</span><br><span class="line">		<span class="keyword">else</span> c[i]=tempa[i]*tempb[i]%mod*tempb[i]%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">ntt</span>(c,n,<span class="number">-1</span>);</span><br><span class="line">	ll invn = <span class="built_in">qmi</span>(n,mod<span class="number">-2</span>,mod);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) c[i]=c[i]*invn%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		val2[<span class="number">0</span>] = <span class="built_in">qmi</span>(val[<span class="number">0</span>],mod<span class="number">-2</span>,mod);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	ll len = (x+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">solve</span>(len);</span><br><span class="line">	<span class="built_in">times</span>(val,val2,temp2,x,<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val2[i]=((<span class="number">2</span>*val2[i]-temp2[i])%mod+mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sqr</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		sqval[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sqr</span>((x+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">	<span class="built_in">times</span>(sqval,sqval,temp,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) temp[i]=(temp[i]+valq[i])%mod;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val[i]=sqval[i],val2[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">solve</span>(x);</span><br><span class="line">	<span class="built_in">times</span>(temp,val2,temp,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) sqval[i]=temp[i]*inv2%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">qd</span><span class="params">(ll *f,ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;x;i++) f[i<span class="number">-1</span>]=f[i]*i;</span><br><span class="line">	f[x<span class="number">-1</span>]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jf</span><span class="params">(ll *f,ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=x<span class="number">-1</span>;i&gt;<span class="number">0</span>;i--) f[i]=f[i<span class="number">-1</span>]*<span class="built_in">qmi</span>(i,mod<span class="number">-2</span>,mod)%mod;</span><br><span class="line">	f[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ln</span><span class="params">(ll *f,ll *ans,ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) val[i]=f[i];</span><br><span class="line">	<span class="built_in">solve</span>(n),<span class="built_in">qd</span>(f,n);</span><br><span class="line">	<span class="built_in">times</span>(f,val2,ans,n,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">jf</span>(ans,n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	G=<span class="number">3</span>,invG=<span class="built_in">qmi</span>(G,mod<span class="number">-2</span>,mod),qm[<span class="number">0</span>]=<span class="number">1</span>,inv2=<span class="built_in">qmi</span>(<span class="number">2</span>,mod<span class="number">-2</span>,mod);</span><br><span class="line">	n=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) tempas[i]=<span class="built_in">read</span>();</span><br><span class="line">	<span class="built_in">ln</span>(tempas,ans,n);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">write</span>(ans[i]),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多项式指数函数-exp"><a href="#多项式指数函数-exp" class="headerlink" title="多项式指数函数 exp"></a>多项式指数函数 exp</h3><h4 id="牛顿迭代"><a href="#牛顿迭代" class="headerlink" title="牛顿迭代"></a>牛顿迭代</h4><p>牛顿迭代主要用来求解一个函数的零点的整数值（不用精确到小数），首先我们随机取一个点 $x$ 算出其函数值 $y&#x3D;f(x)$，然后我们要得到过点 $(x,y)$ 并且切函数 $f(x)$ 的直线。</p>
<p>这个很好办，首先求出导数，即点上的斜率 $f’(x)$，那么直线表达式就是 $y&#x3D;f’(x)(x_0-x)+f(x)$（$x_0$ 是带进去的值）。</p>
<p>然后找到其与 $x$ 轴的交点，令交点为下一次随机选择的点处理即可，即 $y&#x3D;0$，然后得到 $x_0&#x3D;x-\frac{f(x)}{f’(x)}$，放到多项式上也是同理。</p>
<p>那么我们要找到一个函数 $G(x)$ 满足 $F(G(x))&#x3D;0$，那么每次令 $G_0(x)&#x3D;G(x)-\frac {F(G(x))}{(F’(G(x)))}$ 就可以了，事实上每次执行精度都会翻倍，即若 $F(G(x)) \equiv 0 \pmod {x^n}$ 那么 $F(G_0(x)) \equiv 0 \pmod {x^{2n}}$。</p>
<h4 id="牛顿迭代-to-多项式-exp"><a href="#牛顿迭代-to-多项式-exp" class="headerlink" title="牛顿迭代 $\to$ 多项式 exp"></a>牛顿迭代 $\to$ 多项式 exp</h4><p>题目给定 $A(x)$ 求 $B(x) \equiv e^{A(x)} \pmod {x^n}$，那么就有 $\ln B(x)-A(x) \equiv 0 \pmod {x^n}$，我们需要构造函数 $F(G(x))&#x3D;\ln G(x)-A(x) \equiv 0 \pmod {x^n}$。</p>
<p>则 $F’(G(x))&#x3D;(\ln(G(x))’-A(x)’)&#x3D;\frac{1}{G(x)}$，所以 $G_0(x)&#x3D;G(x)-\frac{\ln G(x)-A(x)}{\frac{1}{G(x)}}&#x3D;G(x)-\frac{G(x)(\ln G(x)-A(x))}{1}&#x3D;G(x)(1-\ln G(x)+A(x))$。</p>
<p>所以每次牛顿迭代求解即可，时间复杂度依然是大常数 $O(n \log n)$，边界情况就是 $B(0)&#x3D;G(0)&#x3D;1$。</p>
<p><strong>特别地：只有当 $A(0)&#x3D;0$ 的时候才能用 exp，当 $A(0)&#x3D;1$ 的时候才能用 ln，两者的关系是相互的！</strong></p>
<p>代码以 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4726">P4726 【模板】多项式指数函数（多项式 exp） </a> 为例参考：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 500005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll n,m,x,G,invG,inv2,i,res[N],qm[N],val[N],val2[N],temp[N],temp2[N],nexp[N],expx[N],tempa[N],tempb[N],sqval[N],valqs[N],valq[N],ans[N];</span><br><span class="line">ll tempas[N],tempbs[N],tempcs[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qmi</span><span class="params">(ll a,ll b,ll p)</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">1</span>,t = a;</span><br><span class="line">	<span class="keyword">while</span>(b)&#123;</span><br><span class="line">		<span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*t%p;</span><br><span class="line">		t=t*t%p;</span><br><span class="line">		b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		res[i]=((res[i&gt;&gt;<span class="number">1</span>])&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(i&amp;<span class="number">1</span>) res[i]+=(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(ll *f,ll n,ll type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i&lt;res[i]) <span class="built_in">swap</span>(f[i],f[res[i]]);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;n;i*=<span class="number">2</span>)&#123;</span><br><span class="line">		ll wn = <span class="built_in">qmi</span>((type==<span class="number">1</span>?G:invG),(mod<span class="number">-1</span>)/(i*<span class="number">2</span>),mod);</span><br><span class="line">		<span class="keyword">for</span>(ll j=<span class="number">1</span>;j&lt;i;j++) qm[j]=qm[j<span class="number">-1</span>]*wn%mod;</span><br><span class="line">		<span class="keyword">for</span>(ll r=i*<span class="number">2</span>,j=<span class="number">0</span>;j&lt;n;j+=r)&#123;</span><br><span class="line">			<span class="keyword">for</span>(ll k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">				ll x = f[j+k],y = qm[k]*f[j+k+i]%mod;</span><br><span class="line">				f[j+k] = (x+y)%mod,f[j+k+i] = (x-y+mod)%mod;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">nc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> buf[<span class="number">1000000</span>],*p=buf,*q=buf;</span><br><span class="line">	<span class="keyword">return</span> p==q&amp;&amp;(q=(p=buf)+<span class="built_in">fread</span>(buf,<span class="number">1</span>,<span class="number">1000000</span>,stdin),p==q)?EOF:*p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> c = <span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>)c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;c&gt;=<span class="string">&#x27;0&#x27;</span>)res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> obuf[<span class="number">1</span>&lt;&lt;<span class="number">21</span>],*p3=obuf; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> c)</span></span>&#123; </span><br><span class="line">	p3-obuf&lt;=(<span class="number">1</span>&lt;&lt;<span class="number">20</span>)?(*p3++=c):(<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout),p3=obuf,*p3++=c); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(ll x)</span></span>&#123; </span><br><span class="line">	<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>),x=-x; </span><br><span class="line">	<span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>); </span><br><span class="line">	<span class="built_in">pc</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">times</span><span class="params">(ll *a,ll *b,ll *c,ll n,ll tim)</span></span>&#123;</span><br><span class="line">	ll nn = n;</span><br><span class="line">	<span class="keyword">while</span>((n&amp;(-n))!=n) n++;</span><br><span class="line">	n*=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) tempa[i]=(i&gt;=nn?<span class="number">0</span>:a[i]),tempb[i]=(i&gt;=nn?<span class="number">0</span>:b[i]);</span><br><span class="line">	<span class="built_in">init</span>(n),<span class="built_in">ntt</span>(tempa,n,<span class="number">1</span>),<span class="built_in">ntt</span>(tempb,n,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(tim==<span class="number">1</span>) c[i]=tempa[i]*tempb[i]%mod;</span><br><span class="line">		<span class="keyword">else</span> c[i]=tempa[i]*tempb[i]%mod*tempb[i]%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">ntt</span>(c,n,<span class="number">-1</span>);</span><br><span class="line">	ll invn = <span class="built_in">qmi</span>(n,mod<span class="number">-2</span>,mod);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) c[i]=c[i]*invn%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		val2[<span class="number">0</span>] = <span class="built_in">qmi</span>(val[<span class="number">0</span>],mod<span class="number">-2</span>,mod);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	ll len = (x+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">solve</span>(len);</span><br><span class="line">	<span class="keyword">for</span>(ll i=len;i&lt;x;i++) val2[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">times</span>(val,val2,temp2,x,<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val2[i]=((<span class="number">2</span>*val2[i]-temp2[i])%mod+mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">poly</span>&#123;ll a,b;&#125;ress,t;</span><br><span class="line">ll nk,nks;</span><br><span class="line">poly <span class="keyword">operator</span>*(poly a,poly b)&#123;<span class="keyword">return</span> (poly)&#123;((a.a*b.a+a.b*b.b%mod*((nks*nks-nk)%mod))+mod)%mod,(a.b*b.a+a.a*b.b)%mod&#125;;&#125;</span><br><span class="line"><span class="function">mt19937 <span class="title">rnd</span><span class="params">(time(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">cipolla</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	nk=n;</span><br><span class="line">	ll x,y;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		x=<span class="built_in">rnd</span>()%mod;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">qmi</span>((((x*x-n)%mod)+mod)%mod,(mod<span class="number">-1</span>)/<span class="number">2</span>,mod)==mod<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ress.a = <span class="number">1</span>,ress.b = <span class="number">0</span>,t.a = x,t.b = <span class="number">1</span>,nks = x;</span><br><span class="line">	y = (mod+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">while</span>(y)&#123;</span><br><span class="line">		<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ress=ress*t;</span><br><span class="line">		t=t*t;</span><br><span class="line">		y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">min</span>(ress.a,mod-ress.a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sqr</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		sqval[<span class="number">0</span>]=<span class="built_in">cipolla</span>(valq[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sqr</span>((x+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">	<span class="built_in">times</span>(sqval,sqval,temp,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) temp[i]=(temp[i]+valq[i])%mod;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val[i]=sqval[i];</span><br><span class="line">	<span class="built_in">solve</span>(x);</span><br><span class="line">	<span class="built_in">times</span>(temp,val2,temp,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) sqval[i]=temp[i]*inv2%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">qd</span><span class="params">(ll *f,ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;x;i++) f[i<span class="number">-1</span>]=f[i]*i;</span><br><span class="line">	f[x<span class="number">-1</span>]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jf</span><span class="params">(ll *f,ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=x<span class="number">-1</span>;i&gt;<span class="number">0</span>;i--) f[i]=f[i<span class="number">-1</span>]*<span class="built_in">qmi</span>(i,mod<span class="number">-2</span>,mod)%mod;</span><br><span class="line">	f[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ln</span><span class="params">(ll *f,ll *ans,ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) val[i]=f[i],val2[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">solve</span>(n),<span class="built_in">qd</span>(f,n);</span><br><span class="line">	<span class="built_in">times</span>(f,val2,ans,n,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">jf</span>(ans,n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;G=<span class="number">3</span>,invG=<span class="built_in">qmi</span>(G,mod<span class="number">-2</span>,mod),qm[<span class="number">0</span>]=<span class="number">1</span>,inv2=<span class="built_in">qmi</span>(<span class="number">2</span>,mod<span class="number">-2</span>,mod);&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">newton</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		expx[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">newton</span>((x+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) tempcs[i]=expx[i];</span><br><span class="line">	<span class="built_in">ln</span>(tempcs,tempas,x);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) tempas[i]=(mod-tempas[i]+nexp[i])%mod;</span><br><span class="line">	tempas[<span class="number">0</span>]=(tempas[<span class="number">0</span>]+<span class="number">1</span>)%mod;</span><br><span class="line">	<span class="built_in">times</span>(tempas,expx,tempbs,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) expx[i]=tempbs[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">init</span>();</span><br><span class="line">	n=<span class="built_in">read</span>();</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) nexp[i]=<span class="built_in">read</span>();</span><br><span class="line">	<span class="built_in">newton</span>(n);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) <span class="built_in">write</span>(expx[i]),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多项式快速幂"><a href="#多项式快速幂" class="headerlink" title="多项式快速幂"></a>多项式快速幂</h3><p>求 $A(x)^k$ 的值，首先取 $\ln$，然后在 $\ln$ 下乘上 $k$，最后再 $\exp$ 回去就可以了。</p>
<p>代码以 <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5273">P5273 【模板】多项式幂函数（加强版） </a> 为例参考：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 500005</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mod 998244353</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">ll n,m,k,x,G,invG,inv2,i,j,valll[N],res[N],qm[N],val[N],val2[N],temp[N],temp2[N],nexp[N],expx[N],tempa[N],tempb[N],sqval[N],valqs[N],valq[N],ans[N];</span><br><span class="line">ll tempas[N],tempbs[N],tempcs[N],vall[N],pos,qms,modphi,ks,ifdy;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">qmi</span><span class="params">(ll a,ll b,ll p)</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">1</span>,t = a;</span><br><span class="line">	<span class="keyword">while</span>(b)&#123;</span><br><span class="line">		<span class="keyword">if</span>(b&amp;<span class="number">1</span>) res=res*t%p;</span><br><span class="line">		t=t*t%p;</span><br><span class="line">		b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		res[i]=((res[i&gt;&gt;<span class="number">1</span>])&gt;&gt;<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>(i&amp;<span class="number">1</span>) res[i]+=(n&gt;&gt;<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ntt</span><span class="params">(ll *f,ll n,ll type)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(i&lt;res[i]) <span class="built_in">swap</span>(f[i],f[res[i]]);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;n;i*=<span class="number">2</span>)&#123;</span><br><span class="line">		ll wn = <span class="built_in">qmi</span>((type==<span class="number">1</span>?G:invG),(mod<span class="number">-1</span>)/(i*<span class="number">2</span>),mod);</span><br><span class="line">		<span class="keyword">for</span>(ll j=<span class="number">1</span>;j&lt;i;j++) qm[j]=qm[j<span class="number">-1</span>]*wn%mod;</span><br><span class="line">		<span class="keyword">for</span>(ll r=i*<span class="number">2</span>,j=<span class="number">0</span>;j&lt;n;j+=r)&#123;</span><br><span class="line">			<span class="keyword">for</span>(ll k=<span class="number">0</span>;k&lt;i;k++)&#123;</span><br><span class="line">				ll x = f[j+k],y = qm[k]*f[j+k+i]%mod;</span><br><span class="line">				f[j+k] = (x+y)%mod,f[j+k+i] = (x-y+mod)%mod;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">char</span> <span class="title">nc</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">char</span> buf[<span class="number">1000000</span>],*p=buf,*q=buf;</span><br><span class="line">	<span class="keyword">return</span> p==q&amp;&amp;(q=(p=buf)+<span class="built_in">fread</span>(buf,<span class="number">1</span>,<span class="number">1000000</span>,stdin),p==q)?EOF:*p++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">	ll res = <span class="number">0</span>;</span><br><span class="line">	modphi = <span class="number">0</span>;</span><br><span class="line">	ifdy = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span> c = <span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>)c=<span class="built_in">nc</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&lt;=<span class="string">&#x27;9&#x27;</span>&amp;&amp;c&gt;=<span class="string">&#x27;0&#x27;</span>)res=res*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>,ifdy|=(res&gt;=mod),modphi=modphi*<span class="number">10</span>+c-<span class="string">&#x27;0&#x27;</span>,c=<span class="built_in">nc</span>(),res%=mod,modphi%=(mod<span class="number">-1</span>);</span><br><span class="line">	<span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> obuf[<span class="number">1</span>&lt;&lt;<span class="number">21</span>],*p3=obuf; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">pc</span><span class="params">(<span class="type">char</span> c)</span></span>&#123; </span><br><span class="line">	p3-obuf&lt;=(<span class="number">1</span>&lt;&lt;<span class="number">20</span>)?(*p3++=c):(<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout),p3=obuf,*p3++=c); </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(ll x)</span></span>&#123; </span><br><span class="line">	<span class="keyword">if</span>(x&lt;<span class="number">0</span>) <span class="built_in">pc</span>(<span class="string">&#x27;-&#x27;</span>),x=-x; </span><br><span class="line">	<span class="keyword">if</span>(x&gt;<span class="number">9</span>) <span class="built_in">write</span>(x/<span class="number">10</span>); </span><br><span class="line">	<span class="built_in">pc</span>(x%<span class="number">10</span>+<span class="string">&#x27;0&#x27;</span>); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">times</span><span class="params">(ll *a,ll *b,ll *c,ll n,ll tim)</span></span>&#123;</span><br><span class="line">	ll nn = n;</span><br><span class="line">	<span class="keyword">while</span>((n&amp;(-n))!=n) n++;</span><br><span class="line">	n*=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) tempa[i]=(i&gt;=nn?<span class="number">0</span>:a[i]),tempb[i]=(i&gt;=nn?<span class="number">0</span>:b[i]);</span><br><span class="line">	<span class="built_in">init</span>(n),<span class="built_in">ntt</span>(tempa,n,<span class="number">1</span>),<span class="built_in">ntt</span>(tempb,n,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(tim==<span class="number">1</span>) c[i]=tempa[i]*tempb[i]%mod;</span><br><span class="line">		<span class="keyword">else</span> c[i]=tempa[i]*tempb[i]%mod*tempb[i]%mod;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">ntt</span>(c,n,<span class="number">-1</span>);</span><br><span class="line">	ll invn = <span class="built_in">qmi</span>(n,mod<span class="number">-2</span>,mod);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) c[i]=c[i]*invn%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">solve</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		val2[<span class="number">0</span>] = <span class="built_in">qmi</span>(val[<span class="number">0</span>],mod<span class="number">-2</span>,mod);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	ll len = (x+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="built_in">solve</span>(len);</span><br><span class="line">	<span class="keyword">for</span>(ll i=len;i&lt;x;i++) val2[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">times</span>(val,val2,temp2,x,<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val2[i]=((<span class="number">2</span>*val2[i]-temp2[i])%mod+mod)%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">poly</span>&#123;ll a,b;&#125;ress,t;</span><br><span class="line">ll nk,nks,kifdy;</span><br><span class="line">poly <span class="keyword">operator</span>*(poly a,poly b)&#123;<span class="keyword">return</span> (poly)&#123;((a.a*b.a+a.b*b.b%mod*((nks*nks-nk)%mod))+mod)%mod,(a.b*b.a+a.a*b.b)%mod&#125;;&#125;</span><br><span class="line"><span class="function">mt19937 <span class="title">rnd</span><span class="params">(time(<span class="number">0</span>))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">cipolla</span><span class="params">(ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	nk=n;</span><br><span class="line">	ll x,y;</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		x=<span class="built_in">rnd</span>()%mod;</span><br><span class="line">		<span class="keyword">if</span>(<span class="built_in">qmi</span>((((x*x-n)%mod)+mod)%mod,(mod<span class="number">-1</span>)/<span class="number">2</span>,mod)==mod<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ress.a = <span class="number">1</span>,ress.b = <span class="number">0</span>,t.a = x,t.b = <span class="number">1</span>,nks = x;</span><br><span class="line">	y = (mod+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">while</span>(y)&#123;</span><br><span class="line">		<span class="keyword">if</span>(y&amp;<span class="number">1</span>) ress=ress*t;</span><br><span class="line">		t=t*t;</span><br><span class="line">		y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">min</span>(ress.a,mod-ress.a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">sqr</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		sqval[<span class="number">0</span>]=<span class="built_in">cipolla</span>(valq[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">sqr</span>((x+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">	<span class="built_in">times</span>(sqval,sqval,temp,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) temp[i]=(temp[i]+valq[i])%mod;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) val[i]=sqval[i];</span><br><span class="line">	<span class="built_in">solve</span>(x);</span><br><span class="line">	<span class="built_in">times</span>(temp,val2,temp,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) sqval[i]=temp[i]*inv2%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">qd</span><span class="params">(ll *f,ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">1</span>;i&lt;x;i++) f[i<span class="number">-1</span>]=f[i]*i;</span><br><span class="line">	f[x<span class="number">-1</span>]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">jf</span><span class="params">(ll *f,ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=x<span class="number">-1</span>;i&gt;<span class="number">0</span>;i--) f[i]=f[i<span class="number">-1</span>]*<span class="built_in">qmi</span>(i,mod<span class="number">-2</span>,mod)%mod;</span><br><span class="line">	f[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ln</span><span class="params">(ll *f,ll *ans,ll n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;n;i++) val[i]=f[i],val2[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="built_in">solve</span>(n),<span class="built_in">qd</span>(f,n);</span><br><span class="line">	<span class="built_in">times</span>(f,val2,ans,n,<span class="number">1</span>);</span><br><span class="line">	<span class="built_in">jf</span>(ans,n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;G=<span class="number">3</span>,invG=<span class="built_in">qmi</span>(G,mod<span class="number">-2</span>,mod),qm[<span class="number">0</span>]=<span class="number">1</span>,inv2=<span class="built_in">qmi</span>(<span class="number">2</span>,mod<span class="number">-2</span>,mod);&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">newton</span><span class="params">(ll x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(x==<span class="number">1</span>)&#123;</span><br><span class="line">		expx[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> ;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">newton</span>((x+<span class="number">1</span>)/<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) tempcs[i]=expx[i];</span><br><span class="line">	<span class="built_in">ln</span>(tempcs,tempas,x);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) tempas[i]=(mod-tempas[i]+nexp[i])%mod;</span><br><span class="line">	tempas[<span class="number">0</span>]=(tempas[<span class="number">0</span>]+<span class="number">1</span>)%mod;</span><br><span class="line">	<span class="built_in">times</span>(tempas,expx,tempbs,x,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(ll i=<span class="number">0</span>;i&lt;x;i++) expx[i]=tempbs[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">init</span>();</span><br><span class="line">	n=<span class="built_in">read</span>();</span><br><span class="line">	n++;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) vall[i]=<span class="built_in">read</span>(),valll[i]=vall[i];</span><br><span class="line">	k=<span class="built_in">read</span>(),ks=modphi,kifdy=ifdy;</span><br><span class="line">	m=<span class="built_in">read</span>();</span><br><span class="line">	n=<span class="built_in">max</span>(n,m);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) <span class="keyword">if</span>(vall[i]!=<span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">	pos=i;</span><br><span class="line">	<span class="keyword">for</span>(j=i;j&lt;n;j++) vall[j-i]=valll[j];</span><br><span class="line">	n-=pos,qms=valll[pos];</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) vall[i]=vall[i]*<span class="built_in">qmi</span>(qms,mod<span class="number">-2</span>,mod)%mod;</span><br><span class="line">	<span class="built_in">ln</span>(vall,nexp,n);</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n;i++) nexp[i]=nexp[i]*k%mod;</span><br><span class="line">	<span class="built_in">newton</span>(n);</span><br><span class="line">	<span class="keyword">if</span>(pos&gt;<span class="number">0</span>&amp;&amp;kifdy)&#123;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;n+pos;i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(i&gt;=m) <span class="keyword">break</span>;</span><br><span class="line">			<span class="built_in">write</span>(<span class="number">0</span>),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="built_in">min</span>(n+pos,pos*k);i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(i&gt;=m) <span class="keyword">break</span>;</span><br><span class="line">		<span class="built_in">write</span>(<span class="number">0</span>),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(i=pos*k;i&lt;n+pos;i++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(i&gt;=m) <span class="keyword">break</span>;</span><br><span class="line">		<span class="built_in">write</span>(expx[i-pos*k]*<span class="built_in">qmi</span>(qms,ks,mod)%mod),<span class="built_in">pc</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">fwrite</span>(obuf,p3-obuf,<span class="number">1</span>,stdout);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">10 3</span></span><br><span class="line"><span class="comment">0 0 4 2 1 5 6 7 9 5</span></span><br><span class="line"><span class="comment">0 0 0 27 108 198</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>代码中添加了加强版的数据判断，因为有可能不保证 $A(0)&#x3D;1$，所以要找到一个最小的 $i$ 使得 $\forall 0 \le j&lt;i,A(j)&#x3D;0,A(i) \ne 0$，然后全部除以 $A(i)x^i$，这样的话 $A(0)$ 就是 $1$ 了。</p>
<p>最后答案需要乘上 $A(i)^k x^{ik}$，特别注意，输入的 $k$ 次方满足 $A(x)^k \equiv A(x)^{k \ \bmod \ p} \pmod{p}$，$p$ 足够大，这道题 $p&#x3D;998244353$ 已经足够大了。</p>
<p>但是 $A(i)^k$ 却不满足上述公式，它满足的是欧拉公式，即 $A(i)^k \equiv A(i)^{k \ \bmod \ \varphi(p)} \pmod p$，所以还要新建一个变量表示 $k \bmod \varphi(p)$。（前提是 $\gcd(p,k)$ 互质，因为 $p&#x3D;998244353$，所以也可以使用）</p>
<p>最后记得特判一下 $x^{ik} \ge x^n$ 的情况。</p>
<script src="https://giscus.app/client.js"
        data-repo="acoipp/blog_pl"
        data-repo-id="R_kgDOLPCpEQ"
        data-category="Announcements"
        data-category-id="DIC_kwDOLPCpEc4CdAa7"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
</script>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="/mus/mu2.mp3">
            </audio>
            
        </div>
        
        
    <div id="gitalk-container" class="comment link"
		data-enable="false"
        data-ae="true"
        data-ci="5716fc2235b32d5b5e82"
        data-cs="907f96f6afbbcc0aca96b83eb204923010538f26"
        data-r="acoipp.github.io-"
        data-o="Acoipp"
        data-a="Acoipp"
        data-d="true"
        data-p="https://proxy-gitalk-api.netlify.app/github_access_token"
    >查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    });
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
</script>




</html>
